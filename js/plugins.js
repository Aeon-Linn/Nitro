/* Filters Plugin for Nitro
 * By Jono Cooper & George Czabania
 * Licensed under the BSD License
 *///Adds as a plugin
plugin.add(function(){console.log("Loaded filter.js");filter=function(a,b){var c=function(a,b,d){if(typeof d=="object"){var e=!1;for(var f=0;f<d.length;f++)c(a,b,d[f])&&(e=!0);return e}switch(b){case"logged":if(d===!0){if(typeof a[b]=="number")return!0}else if(typeof d=="number"&&a[b]>=d)return!0;break;case"notes":if(d===!0&&a[b].match(/\S/))return!0;break;case"priority":if(d===!1)d="none";else if(d===!0&&a[b]!=="none")return!0;break;case"date":if(d===!0&&a[b]!=0)return!0;var g=new Date(a[b]),h=new Date;if(d=="month"&&g.getMonth()==h.getMonth())return!0;var i=new Date(g.getFullYear(),g.getMonth(),g.getDate()),j=new Date(h.getFullYear(),h.getMonth(),h.getDate()),k=864e5,l=i.getTime()-j.getTime(),m=l/k,n=Math.floor(m);if(d=="overdue"){if(n<0)return!0}else if(d=="today"){if(n===0)return!0}else if(d=="tomorrow"){if(n<=1)return!0}else if(d=="week"){if(n<=7)return!0}else if(d=="fortnight"){if(n<=14)return!0}else if(typeof d=="number"&&n<=d)return!0}return a[b]==d?!0:!1},d=[];for(var e=0;e<a.length;e++){var f=core.storage.tasks[a[e]];for(var g in b){b[g]==="true"&&(b[g]=!0);b[g]==="false"&&(b[g]=!1);c(f,g,b[g])&&d.push(a[e])}}if(b==="logged")for(var e=0;e<core.storage.tasks.length;e++)!core.storage.tasks[e].hasOwnProperty("deleted")&&core.storage.tasks[e].logged&&core.storage.tasks[e].list!=="logbook"&&d.push(e);return d}});plugin.add(function(){var a,b=$.i18n;core.storage.lists.items.scheduled||(core.storage.lists.items.scheduled={order:[],time:{name:0,order:0}});$smartlists.on("ready",function(){console.log("Loading scheduled.js");var c=Mustache.to_html(templates.list,{id:"scheduled",name:b._("scheduled")});$("#Lnext").after(c);a=$("#Lscheduled");a.find(".count").html(core.list("scheduled").populate().length)});$("body").append('		<div id="scheduledDialog">			<div class="inner">				<table>					<tr class="radioscheduled">						<td><input type="radio" name="scheduledtype" id="scheduledRadio" value="scheduled" checked></td>						<td><label for="scheduledRadio" class="translate" data-translate="scheduled"></label></td>					</tr>					<tr class="radioscheduled bottom">						<td><input type="radio" name="scheduledtype" value="recurring" id="recurringRadio"></td>						<td><label for="recurringRadio" class="translate" data-translate="recurring"></label><br></td>					</tr>					<tr class="schedule">						<td>							<label for="reviewNo" class="translate" data-translate="reviewNo"></label>						</td>						<td>							<input id="reviewNo" min="1" type="number">							<select id="reviewLength">								<option value="days" class="translate" data-translate="days"></option>								<option value="weeks" class="translate" data-translate="weeks"></option>								<option value="months" class="translate" data-translate="months"></option>								<option value="years" class="translate" data-translate="years"></option>							</select>						</td>					</tr>					<tr class="schedule">						<td>							<label for="reviewAction" class="translate" data-translate="reviewAction"></label>						</td>						<td>							<select class="reviewAction"></select><br>						</td>					</tr> <tr class="recurring"> <td><label for="recurType" class="translate" data-translate="recurType"></label></td> <td><select id="recurType"> <option value="daily" class="translate" data-translate="daily"></option>								<option value="weekly" class="translate" data-translate="weekly"></option>								<option value="monthly"class="translate" data-translate="monthly"></option>							</select></td>					</tr>				</table>					<div class="recurring" id="recurSpecial"></div>				<table>					<tr class="recurring"> <td><label for="recurNext" class="translate" data-translate="recurNext"></label></td> <td><input type="text" id="recurNext" placeholder="Next Occurance"></td> </tr> <tr class="recurring"> <td><label for="recurEnds" class="translate" data-translate="recurEnds"></label></td> <td><input type="text" id="recurEnds" placeholder="Last Occurance"></td> </tr> <tr class="recurring"> <td>							<label for="reviewAction" class="translate" data-translate="reviewAction"></label>						</td>						<td>							<select class="reviewAction"></select><br>						</td>					</tr>				</table>				<div id="buttonbox">					<button class="cancel translate" data-translate="cancel"></button>					<button class="create"></button>				</div>			</div>		</div>');$("#scheduledDialog .translate").map(function(){$(this).html($.i18n._($(this).attr("data-translate")))});$("#scheduledDialog .inner .create").click(function(){var a=$(this).parent().parent().attr("data-type"),b=parseInt($("#reviewNo").val()),c=$("#reviewLength").val(),d=new Date;d.setSeconds(0);d.setMinutes(0);d.setHours(0);var e=new Date;c=="days"?d.setDate(d.getDate()+b):c=="weeks"?d.setDate(d.getDate()+b*7):c=="months"?d.setMonth(d.getMonth()+b):c=="years"&&d.setYear(d.getFullYear()+b);if(a=="add"){if($("#scheduledDialog input[type=radio]:checked").val()==="scheduled"){plugin.scheduled.core.add("New Task","scheduled");var f=core.storage.tasks[core.storage.lists.items.scheduled.order.length-1];f.next=d.getTime();f.list=$(".schedule .reviewAction").val()}else if($("#scheduledDialog input[type=radio]:checked").val()==="recurring"){var g=$("#recurNext").val();if(g==""||new Date(g)=="Invalid Date")return;plugin.scheduled.core.add("New Task","recurring");var f=core.storage.tasks[core.storage.lists.items.scheduled.order.length-1];f.next=(new Date($("#recurNext").val())).getTime();$("#recurEnds").val()==""?f.ends="":f.ends=(new Date($("#recurEnds").val())).getTime();f.list=$(".recurring .reviewAction").val();f.recurType=$("#recurType").val();if(f.recurType==="daily")f.recurInterval=[parseInt($("#recurSpecial input").val())];else if(f.recurType==="weekly"){var h=[];$("#recurSpecial div").map(function(){h.push([parseInt($(this).children("input").val()),$(this).children("select").val(),f.next])});f.recurInterval=h}else if(f.recurType=="monthly"){var h=[];$("#recurSpecial div").map(function(){h.push([1,parseInt($(this).children(".type").val()),"day",f.next])});f.recurInterval=h}}}else{var a=core.storage.tasks[a].type.substr(0,1)+a,f=core.storage.tasks[a.substr(1)];if(a.substr(0,1)=="s"){f.next=(new Date(d)).getTime();f.list=$(".schedule .reviewAction").val()}else if(a.substr(0,1)=="r"){f.next=$("#recurNext").val();f.ends=$("#recurEnds").val();f.recurType=$("#recurType").val();if(f.recurType==="daily")f.recurInterval=[parseInt($("#recurSpecial input").val())];else if(f.recurType==="weekly"){var h=[];$("#recurSpecial div").map(function(){h.push([parseInt($(this).children("input").val()),$(this).children("select").val(),f.next])});f.recurInterval=h}else if(f.recurType=="monthly"){var h=[];$("#recurSpecial div").map(function(){h.push([1,parseInt($(this).children(".type").val()),"day",f.next])});f.recurInterval=h}}}core.storage.save();$("#scheduledDialog .inner").fadeOut(150);$("#scheduledDialog").hide(0);plugin.scheduled.core.update();$("#Lscheduled .name").click();obj.view.$(".count").html(core.list("scheduled").populate().length);obj.view.$().attr("id","L"+obj.model.get("id"));ui.lists.update().count()});$("#scheduledDialog .cancel").click(function(){$addBTN.click()});var c='<input type="number"> weeks on <select><option value="1">Monday</option><option value="2">Tuesday</option><option value="3">Wednesday</option> <option value="4">Thursday</option> <option value="5">Friday</option> <option value="6">Saturday</option> <option value="0">Sunday</option></select>',d='on the <select class="type"><option value="1">1st</option> <option value="2">2nd</option> <option value="3">3rd</option> <option value="4">4th</option> <option value="5">5th</option> <option value="6">6th</option> <option value="7">7th</option> <option value="8">8th</option> <option value="9">9th</option> <option value="10">10th</option> <option value="11">11th</option> <option value="12">12th</option> <option value="13">13th</option> <option value="14">14th</option> <option value="15">15th</option> <option value="16">16th</option> <option value="17">17th</option> <option value="18">18th</option> <option value="19">19th</option> <option value="20">20th</option> <option value="21">21st</option> <option value="22">22nd</option> <option value="23">23rd</option> <option value="24">24th</option> <option value="25">25th</option> <option value="26">26th</option> <option value="27">27th</option> <option value="28">28th</option> <option value="29">29th</option> <option value="30">30th</option> <option value="31">31st</option></select> day';$body.on("click",".addRecur",function(){var a=$("#recurType").val();a==="weekly"?$("#recurSpecial").append("<div>And "+c+'<span class="removeRecur">-</span></div>'):a==="monthly"&&$("#recurSpecial").append("<div>And "+d+'<span class="removeRecur">-</span></div>')});$body.on("click",".removeRecur",function(){$(this).parent().remove()});$("#recurNext, #recurEnds").datepicker();$("#scheduledDialog input[type=radio]").on("change",function(){var a=$(this).val();if(a==="scheduled"){$("#scheduledDialog .inner .schedule").show(0);$("#scheduledDialog .inner .recurring").hide(0)}else if(a==="recurring"){$("#scheduledDialog .inner .schedule").hide(0);$("#scheduledDialog .inner .recurring").show(0)}});$("#recurSpecial").html('<table><tr><td>Every:</td><td><input type="number" min="1" value="7"> days</td></tr></table>');$("#recurType").on("change",function(){var a=$(this).val();a==="daily"?$("#recurSpecial").html('<table><tr><td>Every:</td><td><input type="number" min="1" value="7"> days</td></tr></table>'):a==="weekly"?$("#recurSpecial").html("<div>Every "+c+'<span class="addRecur">+</span></div>'):a==="monthly"&&$("#recurSpecial").html("<div>Every month "+d+'<span class="addRecur">+</span></div>')});plugin.scheduled={core:{add:function(a,b){var c=core.storage.tasks.length;core.storage.tasks.length++;b==="scheduled"?core.storage.tasks[c]={content:a,priority:"none",date:"",notes:"",list:"today",type:"scheduled",next:"0",date:"",synced:!1,time:{content:0,priority:0,date:0,notes:0,list:0,type:0,next:0,date:0}}:b==="recurring"&&(core.storage.tasks[c]={content:a,priority:"none",date:"",notes:"",list:"today",type:"recurring",next:"0",date:"",recurType:"daily",recurInterval:[1],ends:"0",synced:!1,time:{content:0,priority:0,date:0,notes:0,list:0,type:0,next:0,date:0,recurType:0,recurInterval:0,ends:0}});core.storage.lists.items.scheduled.order.unshift(c);core.storage.save();console.log("Added a new "+b+" task")},update:function(){for(var a=0;a<core.storage.lists.items.scheduled.order.length;a++){var b=core.storage.lists.items.scheduled.order[a],c=core.storage.tasks[b];if(c.next!="0"&&(new Date(c.next)).getTime()<=(new Date).getTime()){core.task().add(c.content,c.list);var d=core.storage.tasks[core.storage.tasks.length-1];d.notes=c.notes;d.priority=c.priority;if(c.type=="scheduled"){console.log(b);core.task(b).move("trash");console.log("Task: "+b+" has been scheduled")}else if(c.type=="recurring"){if(c.ends!=0||c.ends!="")if((new Date(c.ends)).getTime()<=(new Date).getTime()){console.log("The recurring has come to an end. Casting into oblivion.");core.task(b).move("trash");return}if(c.date!=""){var e=new Date(c.next);e.setDate(e.getDate()+parseInt(c.date));d.date=e.getTime()}if(c.recurType=="daily"){var e=new Date(c.next);e.setDate(e.getDate()+c.recurInterval[0]);c.next=e.getTime()}else if(c.recurType=="weekly"){var f=[];for(var g in c.recurInterval){if((new Date(c.recurInterval[g][2])).getTime()<=(new Date).getTime()){c.recurInterval[g][2]=(new Date(c.recurInterval[g][2])).setDate((new Date(c.recurInterval[g][2])).getDate()+7*parseInt(c.recurInterval[g][0]));var h=parseInt(c.recurInterval[g][1]),i=(new Date(c.recurInterval[g][2])).getDay(),j=h-i==0?7:h-i;c.recurInterval[g][2]=(new Date(c.recurInterval[g][2])).setDate(c.recurInterval[g][2].getDate()+j)}f.push((new Date(c.recurInterval[g][2])).getTime())}c.next=Array.min(f).getTime()}else if(c.recurType=="monthly"){var f=[];for(var g in c.recurInterval){(new Date(c.recurInterval[g][3])).getTime()<=(new Date).getTime()&&c.recurInterval[g][2]=="day"&&((new Date.setDate(c.recurInterval[g][1])).getTime()<=(new Date).getTime()?c.recurInterval[g][3]=(new Date).setDate(c.recurInterval[g][1]).setMonth((new Date).getMonth()+1).getTime():c.recurInterval[g][3]=(new Date).setDate(c.recurInterval[g][1]).getTime());f.push((new Date(c.recurInterval[g][3])).getTime())}c.next=Array.min(f).getTime()}console.log("Task: "+a+" has been recurred")}core.storage.save()}}}},ui:{add:function(){$("#scheduledDialog .inner").fadeToggle(150).attr("data-type","add");$(".radioscheduled input[value=scheduled]").attr("checked","true");$("#scheduledDialog").toggle(0);plugin.scheduled.ui.init("add")},init:function(a){if(a=="edit"){var b=$("#scheduledDialog .inner").attr("data-type"),b=core.storage.tasks[b].type.substr(0,1)+b,c=core.storage.tasks[b.substr(1)],d=$.i18n._("edit");if(b.substr(0,1)=="s"){var e=new Date;e.setSeconds(0);e.setMinutes(0);e.setHours(0);var f=new Date(c.next),g=Math.round((f.getTime()-e.getTime())/1e3/60/60/24),h="days",i=c.list;$("#scheduledDialog .inner .schedule").show(0);$("#scheduledDialog .inner .recurring").hide(0)}else if(b.substr(0,1)=="r"){$("#scheduledDialog .inner .schedule").hide(0);$("#scheduledDialog .inner .recurring").show(0);$("#recurType").val(c.recurType).change();if(c.recurType=="daily")$("#recurSpecial input").val(c.recurInterval[0]);else if(c.recurType=="weekly")for(var j=0;j<c.recurInterval.length;j++){j!=0&&$(".addRecur").click();$($("#recurSpecial div")[j]).children("input").val(c.recurInterval[j][0]);$($("#recurSpecial div")[j]).children("select").val(c.recurInterval[j][1])}else if(c.recurType=="monthly")for(var j=0;j<c.recurInterval.length;j++){j!=0&&$(".addRecur").click();$($("#recurSpecial div")[j]).children(".type").val(c.recurInterval[j][1])}$("#recurNext").datepicker("setDate",new Date(c.next));$("#recurEnds").val()!=""?$("#recurEnds").datepicker("setDate",new Date(c.ends)):$("#recurEnds").val("")}$(".radioscheduled").hide(0)}else{var g=5,h="days",i="today",d=$.i18n._("create");$(".radioscheduled").show(0);$("#scheduledDialog .inner .schedule").show(0);$("#scheduledDialog .inner .recurring").hide(0)}var k='<option value="today">'+$.i18n._("today")+'</option><option value="next">'+$.i18n._("next")+"</option>";for(var j=0;j<core.storage.lists.order.length;j++)k+='<option value="'+core.storage.lists.order[j]+'">'+core.storage.lists.items[core.storage.lists.order[j]].name+"</option>";$(".reviewAction").html(k);$("#reviewNo").val(g);$("#reviewLength").val(h);$(".reviewAction").val(i);$("#scheduledDialog .inner .create").html(d)}}}});plugin.add(function(){plugin.scheduled.core.update()});Array.max=function(a){return Math.max.apply(Math,a)};Array.min=function(a){return Math.min.apply(Math,a)};plugin.add(function(){$(document).ready(function(){$panel.right.append('<input id="search" type="search" placeholder="Search">');$search=$("#search")});$panel.right.on("keyup","#search",function(){var a=$(this),b=a.val(),c=function(a){var b=[],c=!0;for(var e=0;e<d.length;e++){f=new RegExp(d[e],"i");if(typeof a=="function")return;var g=core.storage.tasks[a];f.test(g.content+g.notes+"#"+g.tags.toString().replace(/,/g," #"))?b.push(!0):b.push(!1)}for(var h=0;h<b.length;h++)b[h]===!1&&(c=!1);if(c)return a};if(b=="")$sidebar.find(".selected .name").click();else{$tasks.html("<h2>Search Results: "+a.val()+"</h2><ul></ul>");var d=b.split(" "),e=[],f;if(ui.session.selected=="all"){for(var g=0;g<core.storage.tasks.length;g++)if(core.storage.tasks[g]){var h=c(g);h!=undefined&&e.push(h)}}else for(var i in core.storage.lists.items[ui.session.selected].order){var h=parseInt(c(core.storage.lists.items[ui.session.selected].order[i]));isNaN(h)||e.push(h)}$tasks.find("ul").append(ui.lists.drawTasks(e))}})});$(document).ready(function(){$panel.right.prepend('<button class="settingsbtn"></button>');var a=$(".settingsbtn");a.on("click",function(){$("#prefsDialog").modal()});$("body").append('		<div id="prefsDialog">			<ul class="nav nav-tabs"><li class="active"><a href="#" data-target="#tabGeneral" data-toggle="tab" class="translate" data-translate="general">g</a></li><li><a href="#" data-target="#tabLanguage" data-toggle="tab" class="translate" data-translate="language">g</a></li><li><a href="#" data-target="#tabTheme" data-toggle="tab" class="translate" data-translate="theme">g</a></li><li><a href="#" data-target="#tabSync" data-toggle="tab" class="translate" data-translate="sync">g</a></li></ul>			<div class="tab-content">  				<div class="tab-pane active" id="tabGeneral">				<form>					<input type="checkbox" id="deleteWarnings"><label for="deleteWarnings" class="translate" data-translate="hideWarnings"></label><br>					<label class="description translate" data-translate="deleteWarningsDescription"></label>					<hr>					<label class="left translate" data-translate="nextDescription"> </label><select id="nextAmount">						<option value="noLists" class="translate" data-translate="nextNoLists"></option>						<option value="everything" class="translate" data-translate="nextEverything"></option>					</select>				</form>				</div>  				<div class="tab-pane" id="tabLanguage">					<table>						<thead>							<tr>								<th class="translate" data-translate="language"></th>								<th class="translate" data-translate="authortext"></th>								<th class="translate" data-translate="language"></th>								<th class="translate" data-translate="authortext"></th>							</tr>						</thead>						<tbody>							<tr>								<td class="language"><a href="#" data-value="english">English</a></td>								<td class="author">Caffeinated Code</td>								<td class="language"><a href="#" data-value="bad">Bad English</a></td>								<td class="author"><a href="mailto:jono@joncoooper.com">Jono Cooper</a>							</tr>								<!--td class="language"><a href="#" data-value="hungarian">Magyar</a></td>								<td class="author"><a href="mailto:sjozsef0227@gmail.com">József Samu</a>							</td>							<tr>								<td class="language"><a href="#" data-value="pirate">English (Pirate)</a></td>								<td class="author">Caffeinated Code</td>								<td class="language"><a href="#" data-value="portuguese">Português</a></td>								<td class="author"><a href="mailto:email@belenos.me">Belenos Govannon</a></td>								</tr>							<tr>								<td class="language"><a href="#" data-value="german">Deutsch</a></td>								<td class="author"><a href="mailto:d.peteranderl@googlemail.com">Dennis Peteranderl</a>, <a href="info@agentur-simon.de">Bertram Simon</a></td>								<td class="language"><a href="#" data-value="russian">Русский</a></td>								<td class="author"><a href="mailto:a.pryah@gmail.com">Andrej Pryakhin</a></td>							</tr>							<tr>								<td class="language"><a href="#" data-value="spanish">Español</a></td>								<td class="author"><a href="mailto:admin@bumxu.com">Juande Martos</a></td></td>								<td class="language"><a href="#" data-value="finnish">Suomi</a></td>								<td class="author"><a href="mailto:rami.selin@gmail.com">Rami Selin</a></td>							</tr>							<tr>								<td class="language"><a href="#" data-value="basque">Euskara</a></td>								<td class="author"><a href="mailto:atxooy@gmail.com">Naxo Oyanguren</a></td>								<td class="language"><a href="#" data-value="vietnamese">Tiếng Việt</a></td>								<td class="author"><a href="mailto:dinhquan@narga.net">Nguyễn Đình Quân</a></td>							</tr>							<tr>								<td class="language"><a href="#" data-value="french">Français</a></td>								<td class="author"><a href="mailto:maurin.raphael@gmail.com">Raphaël Maurin</a></td>								<td class="language"><a href="#" data-value="arabic">‏العربية‏</a></td>								<td class="author"><a href="mailto:fouad.hassouneh@gmail.com">Fouad Hassouneh</td>							</tr>							<tr>								<td class="language"><a href="#" data-value="italian">Italiano</a></td>								<td class="author"><a href="mailto:lmassa@bwlab.it.com">Luigi Massa</a></td>								<td class="language"><a href="#" data-value="chinese">中文(简体)</a></td>								<td class="author"><a href="mailto:1132321739qq@gmail.com">tuhaihe</a>, 2012</td>							</tr>							<tr>								<td class="language"><a href="#" data-value="polish">Polski</a></td>								<td class="author">Marcin Tydelski,<br>Kajetan Szczepaniak</td>								<td class="language"><a href="#" data-value="turkish">Türkçe</a></td>								<td class="author"><a href="mailto:selimssevgi@gmail.com">Selim Sırrı Sevgi</a></td>							</tr-->						</tbody>					</table>  				</div>				<div class="tab-pane" id="tabTheme">  					<label class="left translate" data-translate="pickTheme"></label><select id="theme">						<option value="default">Default</option>						<option value="none">None</option>					</select><br>					<label class="description translate" data-translate="themeDescription"></label>					<div class="pythonshit">						<hr>						<label class="left translate" data-translate="replaceDefault"></label><input type="file" id="chooseBG"><br>						<label class="left translate" data-translate="useDefault"></label><button id="removeBG" class="translate" data-translate="removeBG"></button><br>						<label class="left translate" data-translate="bgSize"></label><select id="backgroundSize">							<option value="zoom" class="translate" data-translate="fill"></option>							<option value="shrink" class="translate" data-translate="shrink"></option>							<option value="tile" class="translate" data-translate="tile"></option>						</select>						<label class="description translate" data-translate="bgDescription"></label>						<hr>						<label class="left translate" data-translate="headingColor"></label>						<select id="headingColor">							<option value="light" class="translate" data-translate="light"></option>							<option value="dark" class="translate" data-translate="dark"></option>							<option value="" class="translate" data-translate="default"></option>						</select>						<label class="description translate" data-translate="headingDescription"></label>					</div>				</div>				<div class="tab-pane" id="tabSync">					<div class="connect">						<blockquote><h1>Nitro Sync Beta</h1><span class="translate" data-translate="donateText"></span></blockquote>						<hr>						<div class="icons">							<a class="icon" href="#" data-service="dropbox"><img src="images/dropbox.png"></a>							<a class="icon" href="#" data-service="ubuntu"><img src="images/ubuntu.png"></a>						</div>					</div>					<div class="waiting">						<p class="translate" data-translate="syncAuthenticate"></p>						<img class="spinner" src="images/spinner.gif">						<button class="cancel translate" data-translate="cancel"></button>					</div>					<div class="settings">						<a class="left logout translate" data-translate="syncLogout" href="#"></a>						<label class="left translate" data-translate="syncLoggedIn"></label><span class="email right">Not logged in.</span><br>						<label class="left translate" data-translate="syncService"></label><span class="service">No service set.</span>											<!--label class="left">Delete server: </label><button class="deleteserver">Delete</button>						<label class="description">WARNING: This will delete the nitro_data.json file on your storage account! This action cannot be undone!</label>						<label class="left">Delete client: </label><button class="deleteclient">Delete client</button>						<label class="description">WARNING: This will delete all your tasks! You will lose everything!</label-->						<hr>						<label class="left translate" data-translate="syncLabel"></label><select id="syncInterval">							<option value="never" class="translate" data-translate="syncNever"></option>							<option value="manual" class="translate" data-translate="syncManual"></option>							<option value="timer" class="translate" data-translate="syncTimer"></option>							<option value="auto" class="translate" data-translate="syncAuto"></option>						</select><br>						<label class="description translate" data-translate="syncDescription"></label>					</div>							</div>			</div>		</div>	');$("#prefsDialog .translate").map(function(){$(this).html($.i18n._($(this).attr("data-translate")))});$("#tabGeneral form input").change(function(){core.storage.prefs.deleteWarnings=$("#deleteWarnings").prop("checked");core.storage.save()});$("#nextAmount").change(function(){core.storage.prefs.nextAmount=this.value;core.storage.save();ui.session.selected==="next"&&$("#Lnext .name").click()});$("#theme").change(function(){var a=$(this)[0].value;$("link.theme").attr("href","css/"+a+".css").ready(function(){$(window).resize()});core.storage.prefs.theme=a;core.storage.save()});$("#deleteWarnings").prop("checked",core.storage.prefs.deleteWarnings);$("#nextAmount").val(core.storage.prefs.nextAmount);$("#theme").val(core.storage.prefs.theme);$("#tabLanguage a.current").removeClass("current");$("#tabLanguage .language a").each(function(){$(this).data("value")===core.storage.prefs.lang&&$(this).addClass("current")});$("#tabLanguage").bind("click",function(a){if($(a.srcElement).is(".language a")){core.storage.prefs.lang=$(a.srcElement).data("value");core.storage.save();window.location.reload();return!1}})});var $sortType;plugin.add(function(){console.log("Loaded sort.js");$(document).ready(function(){$panel.left.append('			<span>			<button data-toggle="dropdown" class="sort">Sort</button>			<ul class="dropdown-menu">			  <li class="current" data-value="magic"><span class="icon magic"></span>Magic</li>			  <li data-value="manual"><span class="icon hand"></span>by Hand</li>			  <li data-value="priority"><span class="icon priority"></span>Priority</li>			  <li data-value="date"><span class="icon date"></span>Date</li>			</ul>			</span>');$sortType=$(".panel .left span ul li");$sortType.on("click",function(){$sortType.removeClass("current");$(this).addClass("current");var a=$(this).attr("data-value");core.storage.prefs.listSort[ui.session.selected]=a;$("#L"+ui.session.selected+" .name").click();core.storage.save()})});var a=function(a){if(a=="")return 0;var b=new Date(a),c=new Date,d=new Date(b.getFullYear(),b.getMonth(),b.getDate()),e=new Date(c.getFullYear(),c.getMonth(),c.getDate()),f=864e5,g=d.getTime()-e.getTime(),h=g/f,i=Math.floor(h);i>14&&(i=14);return 14-i+1};plugin.sort=function(b,c){list=b.slice(0);for(var d=0;d<list.length;d++){var e=list[d];list[d]=core.storage.tasks[list[d]];list[d].arrayID=e}switch(c){case"magic":list.sort(function(b,c){var d={a:a(b.date),b:a(c.date)},e={none:0,low:2,medium:6,high:10};d.a+=e[b.priority];d.b+=e[c.priority];return b.logged&&!c.logged?!0:!b.logged&&c.logged?!1:b.logged&&c.logged?null:d.a<d.b?!0:d.c>d.b?!1:null});break;case"manual":break;case"priority":list.sort(function(a,b){var c={none:0,low:1,medium:2,high:3};return a.logged&&!b.logged?!0:!a.logged&&b.logged?!1:a.logged&&b.logged?null:c[a.priority]<c[b.priority]?!0:c[a.priority]>c[b.priority]?!1:null});break;case"date":list.sort(function(a,b){return a.logged&&!b.logged?!0:!a.logged&&b.logged?!1:a.logged&&b.logged?null:a.date==""&&b.date!==""?!0:b.date==""&&a.date!==""?!1:a.date==""&&b.date==""?null:a.date>b.date?!0:a.date<b.date?!1:null})}for(var d=0;d<list.length;d++){var e=list[d].arrayID;delete list[d].arrayID;list[d]=e}return list}});upgrade=function(){var a=$.polyStorage.get("jstorage","empty");if(a==="empty")return;var b=a.tasks,c=a.lists,d=a.prefs;c.items[0]={deleted:0};c.items.logbook={order:[],time:{order:0}};c.scheduled.hasOwnProperty("order")?c.items.scheduled=$.extend(!0,{},c.scheduled):c.items.scheduled={order:[],time:{order:0}};delete c.scheduled;for(var e in b)if(e!="length"){var f=b[e];delete f.showInToday;delete f.today;if(f.hasOwnProperty("time")){delete f.time.showInToday;delete f.time.today}if(f.logged==="true"||f.logged===!0){f.logged===core.timestamp();f.list="logbook";c.items.logbook.order.push(e)}f.tags=[];if(f.date!==""&&f.hasOwnProperty("date")){var g=new Date(f.date);f.date=g.getTime()}}d.listSort={};localStorage.removeItem("jstorage");core.storage.tasks=b;core.storage.lists=c;core.storage.prefs=d;core.storage.save()};plugin.add(function(){$tasks.on("blur","input.tags",function(){var a=$(this).closest("li"),b=$(this).val(),c={id:a.attr("data-id").toNum()},d=core.storage.tasks[c.id],e=b.split(/\s*,\s*/);for(var f=0;f<e.length;f++)e[f].length==0&&e.splice(f,1);d.tags=e;core.storage.save("tasks",c.id,"tags")});$tasks.on("click",".tag",function(){var a="#"+$(this).text();$("#Lall .name").trigger("click");$search.val(a).trigger("keyup")})});timer={loadList:function(){var a=$("#L0 .name")[0];console.time("n");for(var b=1;b<2;b++)a.click();console.timeEnd("n")},addTask:function(){var a=$("button.add")[0];console.time("n");for(var b=1;b<101;b++)a.click();console.timeEnd("n")},mustache:function(a){$("body").empty();var b="";console.time("n");for(var c=0;c<a.length;c++){var d=core.storage.tasks[a[c]];b+=Mustache.to_html(templates.task.collapsed,{id:c,content:d.content,notes:d.notes,date:d.date,priority:d.priority})}$("body").html(b);console.timeEnd("n")}};plugin.add(function(){function c(a){var b={name:"a",tasks:"b",content:"c",priority:"d",date:"e",today:"f",showInToday:"g",list:"h",lists:"i",logged:"j",time:"k",sync:"l",synced:"m",order:"n",queue:"o",length:"p",notes:"q",items:"r",next:"s",someday:"t",deleted:"u"},d={};for(var f in a)if(b.hasOwnProperty(f)){d[b[f]]=a[f];typeof a[f]=="object"&&e(a[f])==0&&(d[b[f]]=c(d[b[f]]))}else{d[f]=a[f];typeof a[f]=="object"&&e(a[f])==0&&(d[f]=c(d[f]))}return d}function d(a){var b={a:"name",b:"tasks",c:"content",d:"priority",e:"date",f:"today",g:"showInToday",h:"list",i:"lists",j:"logged",k:"time",l:"sync",m:"synced",n:"order",o:"queue",p:"length",q:"notes",r:"items",s:"next",t:"someday",u:"deleted"},c={};for(var f in a)if(b.hasOwnProperty(f)){c[b[f]]=a[f];typeof a[f]=="object"&&e(a[f])==0&&(c[b[f]]=d(c[b[f]]))}else{c[f]=a[f];typeof a[f]=="object"&&e(a[f])==0&&(c[f]=d(c[f]))}return c}function e(a){return a.constructor==Array}var a="js",b="1.4";sync={run:function(a,b){if(a)core.storage.prefs.sync.service=a;else if(!core.storage.prefs.sync.hasOwnProperty("service")){console.log("Error: Don't know what service to use.");return}if(core.storage.prefs.sync.hasOwnProperty("access")){sync.emit();typeof b=="function"&&b(!0)}else sync.connect(function(a){sync.emit();typeof b=="function"&&b(a)})},ajaxdata:{data:{}},connect:function(b){console.log("Connecting to Nitro Sync server");if(core.storage.prefs.sync.hasOwnProperty("access")){var c=sync.ajaxdata;c.watch("data",function(a,d,e){console.log(e);if(e=="success"){console.log("Nitro Sync server is ready");b(!0)}else if(e=="failed"){console.log("Could not connect to Dropbox");b(!1)}c.unwatch()});if(a=="python"){document.title="null";document.title="ajax|access|"+core.storage.prefs.sync.access+"|"+core.storage.prefs.sync.service}else $.ajax({type:"POST",url:core.storage.prefs.sync.url+"/auth/",dataType:"json",data:{access:JSON.stringify(core.storage.prefs.sync.access),service:core.storage.prefs.sync.service},success:function(a){c.data=a}})}else{var c=sync.ajaxdata;c.watch("data",function(d,e,f){console.log("Verifying Storagebackend");core.storage.prefs.sync.token=f;if(a=="python")document.title="frame|"+f.authorize_url;else{var g=screen.width/2-400,h=screen.height/2-300,i="Authorise Nitro",j=window.open(f.authorize_url,i,"toolbar=no, type=popup, status=no, width=800, height=600, top="+h+", left="+g);a=="web"&&$("#login .container").html('<div class="loading">Loading... You may need to disable your popup blocker.</div>')}c.unwatch();c.watch("data",function(a,d,e){console.log("Nitro Sync server is ready");core.storage.prefs.sync.access=e.access;core.storage.prefs.sync.email=e.email;delete core.storage.prefs.sync.token;b(!0);core.storage.save();c.unwatch()});if(a=="python"){document.title="null";document.title="ajax|token|"+JSON.stringify(core.storage.prefs.sync.token)+"|"+core.storage.prefs.sync.service}else $.ajax({type:"POST",url:core.storage.prefs.sync.url+"/auth/",dataType:"json",data:{token:core.storage.prefs.sync.token,service:core.storage.prefs.sync.service},success:function(a){c.data=a}});return f});if(a=="python"){document.title="null";document.title="ajax|reqURL|"+core.storage.prefs.sync.service}else $.ajax({type:"POST",url:core.storage.prefs.sync.url+"/auth/",dataType:"json",data:{reqURL:"true",service:core.storage.prefs.sync.service},success:function(a){c.data=a}})}},emit:function(){var e={tasks:core.storage.tasks,lists:core.storage.lists,stats:{uid:core.storage.prefs.sync.email,os:a,language:core.storage.prefs.lang,version:b}},f=sync.ajaxdata;f.watch("data",function(a,b,c){c=d(c);console.log("Finished sync");core.storage.tasks=c.tasks;core.storage.lists=c.lists;core
.storage.save()});if(a=="python"){document.title="null";document.title="ajax|sync|"+JSON.stringify(c(e))+"|"+JSON.stringify(core.storage.prefs.sync.access)+"|"+core.storage.prefs.sync.service}else $.ajax({type:"POST",url:core.storage.prefs.sync.url+"/sync/",dataType:"json",data:{data:JSON.stringify(c(e)),access:core.storage.prefs.sync.access,service:core.storage.prefs.sync.service},success:function(a){if(a!="failed"){f.data=a;return!0}return!1},error:function(){alert("An error occured. If it had nothing to do with your internet, it has been reported to the developers =)")}})}};Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(a,b){var c=this[a],d=c,e=function(){return d},f=function(e){c=d;return d=b.call(this,a,c,e)};delete this[a]&&Object.defineProperty(this,a,{get:e,set:f,enumerable:!0,configurable:!0})}});Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(a){var b=this[a];delete this[a];this[a]=b}})});